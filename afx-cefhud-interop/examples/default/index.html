<!DOCTYPE html>
<!--

## Usage:

Launch CS:GO from HLAE with -afxInteropLight.

Execute (will log warings / errors to debug.log in current directoy):
afx-cefhud-interop.exe "--url=file:///C:/source/afx-cefhud-interop/afx-cefhud-interop/examples/default/index.html" --enable-logging --v=1
Use CTRL + C in termianl to quit.

For live execute:
afx-cefhud-interop.exe "--url=file:///C:/source/afx-cefhud-interop/afx-cefhud-interop/examples/default/index.html" --enable-logging --log-severity=error

Enter afx_interop connect 1 into CS:GO console.

Console interface:
afx_interop send cefhud [...]

-->
<html>
<head>
<title>Default example</title>
</head>
<body>
<h1>Default example</h1>
<script type="text/javascript" src="common.js"></script>
<script>

function AfxInterop(interop, args) {
	
	var fileFolderPath = window.location.toString();
	fileFolderPath = fileFolderPath.replace("/index.html","");

	var self = this;
	
	this.interop = interop;
	this.args = args;
	
	this.messageHandlers = {
		"drawingCreated": function(drawingInteropId) {
			console.log("Created drawing interop #"+drawingInteropId);
			this.drawingInteropId = drawingInteropId;
			
			toPromise(this.interop.createEngineInterop,
				fileFolderPath+"/engine.html",
				JSON.stringify({
					"indexInteropId": self.interop.id,
					"drawingInteropId": self.drawingInteropId,
					"pipeName": "advancedfxInterop"
				})
			).catch((e)=>{
				logError(e);
			});
		},
		"engineCreated": function(engineInteropId) {
			console.log("Created engine interop #"+engineInteropId);
			self.engineInteropId = engineInteropId;
		}
	};
	
	interop.onMessage = function(senderId, message){
		self.onMessage(senderId, message);
	};
	interop.onError = function(senderId, message){
		self.onError(senderId, message);
	};
	
	self.drawingInteropId = null;
	self.engineInteropId = null;

	console.log("HAHA");

	toPromise(self.interop.createDrawingInterop,
		fileFolderPath+"/drawing.html",
		JSON.stringify({
			"indexInteropId": self.interop.id,
			"pipeName": "advancedfxInterop_drawing"
		})
	).then(()=>{
		console.log("HI")
	}).catch((e)=>{
		logError(e);
	});
}

AfxInterop.prototype.onMessage = function(senderId, message) {
	const args = JSON.parse(message);
	this.messageHandlers[args.id].apply(this, args.args);
}

AfxInterop.prototype.onError = function(senderId, message) {
	
	if(this.drawingInteropId === senderId)
		throw ("Drawing interop #"+senderId+" error: "+message);
	else if(this.engineInteropId === senderId)
		throw ("Engine interop #"+senderId+" error: "+message);
	else
		throw ("Interop #"+senderId+" error: "+message);
}

////////////////////////////////////////////////////////////////////////////////

//window.open("http://google.com");

window.afxInterop.init(function(interop, message){
	console.log(message);
	new AfxInterop(interop, JSON.parse(message));
});
</script>
</body>
</html>